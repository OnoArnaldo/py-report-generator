import os
from reportgen.layout import Parser
from ..utils import Ignore

ROOT = os.path.abspath(os.path.dirname(__file__))
TEMPLATE = os.path.join(ROOT, 'templates')
DATA = os.path.join(ROOT, 'data')
ASSET = os.path.join(ROOT, 'assets')


def test_layout(canvas):
    parse = Parser(TEMPLATE, DATA, ASSET)
    report = parse('report', 'report_data.xml')

    report.process(canvas)

    canvas.save()

    assert object.__getattribute__(canvas, 'log') == [
        ['canvas/roundRect(..)',
         (28.346456692913385,
          28.346456692913385,
          453.54330708661416,
          85.03937007874015,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 7, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 7'],
        ['canvas/drawString(..)',
         (31.181102362204726, 39.68503937007874, 'Company:'),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)',
         (56.69291338582677, 55.188976377952756, 'The Company'),
         {}],
        ['canvas/setFont', ('Courier', 7, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 7'],
        ['canvas/drawString(..)',
         (31.181102362204726, 87.87401574803148, 'Address:'),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)',
         (56.69291338582677, 103.37795275590551, 'The Address'),
         {}],
        ['canvas/roundRect(..)',
         (481.8897637795275,
          28.346456692913385,
          85.03937007874026,
          85.03937007874015,
          5.0,
          1),
         {}],
        ['canvas/drawImage(..)',
         (Ignore,
          481.8897637795275,
          28.346456692913385,
          85.0393700787402,
          85.03937007874015),
         {'preserveAspectRatio': True}],
        ['canvas/roundRect(..)',
         (28.346456692913385,
          127.55905511811024,
          283.46456692913387,
          14.173228346456696,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)',
         (36.8503937007874, 136.06299212598424, 'Description'),
         {}],
        ['canvas/roundRect(..)',
         (311.81102362204723,
          127.55905511811024,
          141.73228346456693,
          14.173228346456696,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)', (320.31496062992125, 136.06299212598424, 'Qty'), {}],
        ['canvas/roundRect(..)',
         (453.54330708661416,
          127.55905511811024,
          113.38582677165363,
          14.173228346456696,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawRightString(..)',
         (558.4251968503937, 136.06299212598424, 'Price'),
         {}],
        ['canvas/roundRect(..)',
         (28.346456692913385,
          141.73228346456693,
          283.46456692913387,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)',
         (36.8503937007874, 150.23622047244095, 'i001: Item001'),
         {}],
        ['canvas/roundRect(..)',
         (311.81102362204723,
          141.73228346456693,
          141.73228346456693,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)', (320.31496062992125, 150.23622047244095, '10'), {}],
        ['canvas/roundRect(..)',
         (453.54330708661416,
          141.73228346456693,
          113.38582677165363,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawRightString(..)',
         (558.4251968503937, 150.23622047244095, '1000'),
         {}],
        ['canvas/roundRect(..)',
         (28.346456692913385,
          158.74015748031496,
          283.46456692913387,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)',
         (36.8503937007874, 167.24409448818898, 'i002: Item002'),
         {}],
        ['canvas/roundRect(..)',
         (311.81102362204723,
          158.74015748031496,
          141.73228346456693,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)', (320.31496062992125, 167.24409448818898, '20'), {}],
        ['canvas/roundRect(..)',
         (453.54330708661416,
          158.74015748031496,
          113.38582677165363,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawRightString(..)',
         (558.4251968503937, 167.24409448818898, '2000'),
         {}],
        ['canvas/roundRect(..)',
         (28.346456692913385,
          175.748031496063,
          283.46456692913387,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)',
         (36.8503937007874, 184.251968503937, 'i003: Item003'),
         {}],
        ['canvas/roundRect(..)',
         (311.81102362204723,
          175.748031496063,
          141.73228346456693,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawString(..)', (320.31496062992125, 184.251968503937, '30'), {}],
        ['canvas/roundRect(..)',
         (453.54330708661416,
          175.748031496063,
          113.38582677165363,
          17.00787401574803,
          5.0,
          1),
         {}],
        ['canvas/setFont', ('Courier', 10, None), {}],
        ['canvas._fontname = Courier'],
        ['canvas._fontsize = 10'],
        ['canvas/drawRightString(..)',
         (558.4251968503937, 184.251968503937, '3000'),
         {}],
        ['canvas/showPage(..)', (), {}],
        ['canvas/save(..)', (), {}]
    ]
